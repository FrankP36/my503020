<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Budget Planner — Live FX (Exchangerate.host)</title>
<style>
  :root {
    --bg: #0f172a;
    --card: #111827;
    --muted: #94a3b8;
    --text: #e5e7eb;
    --accent: #22c55e;
    --warn: #f59e0b;
    --danger: #ef4444;
    --input: #1f2937;
    --ring: #2563eb33;
    --blue: #2563eb;
  }
  * { box-sizing: border-box; }
  body {
    margin: 0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, Noto Sans;
    background: linear-gradient(180deg, #0b1220, var(--bg));
    color: var(--text);
    min-height: 100vh;
    display: grid;
    place-items: start center;
    padding: 20px;
    transition: all 0.3s ease;
  }
  body.dark {
    background: #121212;
    color: #eee;
  }
  .wrap { width: 100%; max-width: 980px; display: grid; gap: 14px; }
  header { display: grid; gap: 6px; }
  header h1 { margin: 0; font-size: clamp(20px, 3vw, 28px); }
  header p { margin: 0; color: var(--muted); }
  .grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
  @media (min-width: 900px){ .grid { grid-template-columns: 1.1fr 1fr; } }
  .card {
    background: linear-gradient(180deg, #0d1220, var(--card));
    border: 1px solid #1f2937;
    border-radius: 14px;
    padding: 14px;
    box-shadow: 0 10px 24px rgba(0,0,0,0.25);
  }
  .section-title { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; font-weight: 600; }
  .controls { display: grid; gap: 10px; }
  .row { display: grid; grid-template-columns: 1fr auto; align-items: center; gap: 10px; }
  label { color: var(--muted); font-size: 14px; }
  .input, select, .btn { background: var(--input); color: var(--text); border: 1px solid #374151; border-radius: 10px; padding: 10px 12px; outline: none; }
  .input { display: flex; align-items: center; gap: 8px; }
  .input input[type="number"], .input input[type="text"] { flex: 1; background: transparent; border: none; color: var(--text); font-size: 15px; min-width: 0; outline: none; -moz-appearance: textfield; }
  .input input::-webkit-outer-spin-button, .input input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
  .hint { font-size: 12px; color: var(--muted); }
  .pill { display: inline-flex; gap: 6px; align-items: center; padding: 6px 10px; border-radius: 999px; font-size: 12px; border: 1px solid #334155; color: var(--muted); background: #0b1324; }
  .btn { cursor: pointer; font-weight: 600; }
  .btn.primary { background: var(--blue); border-color: var(--blue); }
  .btn.ghost { background: transparent; border-color: #334155; }
  .flex { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
  .totals { display: grid; gap: 10px; }
  .stat { display: flex; justify-content: space-between; align-items: baseline; padding: 10px 12px; border-radius: 10px; border: 1px solid #1f2937; background: #0c1426; }
  .stat .label { color: var(--muted); font-size: 13px; }
  .stat .value { font-weight: 700; font-size: 18px; }
  .value.positive { color: var(--accent); }
  .value.warn { color: var(--warn); }
  .value.negative { color: var(--danger); }
  .table { width: 100%; border-collapse: collapse; }
  .table th, .table td { padding: 6px 8px; border-bottom: 1px solid #1f2937; font-size: 14px; }
  .table th { text-align: left; color: var(--muted); font-weight: 600; }
  .small { font-size: 12px; color: var(--muted); }
  .row-actions { display: flex; gap: 6px; }
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Budget Planner</h1>
    <p>Plan your budget with live exchange rates, auto/manual calculation, and 50/30/20 guidance.</p>
    <button id="toggle-dark" class="btn primary">Toggle Dark Mode</button>
  </header>

  <div class="grid">
    <section class="card">
      <div class="section-title"><span>Settings</span><span class="pill" id="periodPill">Monthly</span></div>
      <div class="controls">
        <div class="flex" style="justify-content: space-between; flex-wrap: wrap;">
          <div class="flex" style="gap:12px; flex-wrap: wrap;">
            <div class="flex"><label for="currency" class="hint">Currency</label><select id="currency"></select></div>
            <div class="flex"><label for="period" class="hint">Period</label><select id="period"><option value="monthly">Monthly</option><option value="annual">Annual</option></select></div>
            <div class="flex"><label for="calcMode" class="hint">Calculation</label><select id="calcMode"><option value="auto">Auto</option><option value="manual">Manual</option></select></div>
          </div>
          <div class="flex"><button id="calcBtn" class="btn primary" style="display:none;">Calculate</button><button id="share" class="btn">Copy Snapshot</button></div>
        </div>

        <div class="row"><label for="income">Income</label><div class="input"><span id="curSymbol1">$</span><input id="income" type="number" min="0" step="1" value="3500"></div></div>

        <div class="section-title" style="margin-top:6px;"><span>Categories</span><span class="small">Classify as Needs, Wants, or Savings (50/30/20 guideline).</span></div>

        <table class="table" id="catTable">
          <thead>
            <tr><th style="width:38%;">Name</th><th style="width:22%;">Amount</th><th style="width:20%;">Type</th><th style="width:20%;">Actions</th></tr>
          </thead>
          <tbody id="catBody"></tbody>
        </table>

        <div class="flex"><button id="addRow" class="btn ghost">+ Add Category</button><button id="reset" class="btn">Reset to Example</button></div>
        <p class="small" id="fxStatus"></p>
      </div>
    </section>

    <section class="card">
      <div class="section-title"><span>Results</span></div>
      <div class="totals">
        <div class="stat"><span class="label" id="incomeLabel">Income (Monthly)</span><span class="value" id="incomeVal">$3,500</span></div>
        <div class="stat"><span class="label">Needs total</span><span class="value" id="needsVal">$0</span></div>
        <div class="stat"><span class="label">Wants total</span><span class="value" id="wantsVal">$0</span></div>
        <div class="stat"><span class="label">Savings total</span><span class="value" id="savingsVal">$0</span></div>
        <div class="stat"><span class="label">Total expenses</span><span class="value" id="totalVal">$0</span></div>
        <div class="stat"><span class="label">Remaining</span><span class="value positive" id="remainVal">$0</span></div>
        <div class="stat"><span class="label">Savings as % of income</span><span class="value" id="savingsPct">—</span></div>
        <div class="stat"><span class="label">50/30/20 vs actual</span><span class="value" id="fiveThreeTwo">—</span></div>
      </div>
      <p class="small" id="advice">Enter your numbers to see guidance. Aim for 50% Needs, 30% Wants, 20% Savings as a starting point.</p>
    </section>
  </div>
</div>

<script type="module">
import { Chart } from 'https://cdn.jsdelivr.net/npm/chart.js';
(function(){
  // Dark Mode
  let darkMode = localStorage.getItem('darkMode') === 'true';
  if(darkMode) document.body.classList.add('dark');
  document.getElementById('toggle-dark').addEventListener('click', ()=>{
    document.body.classList.toggle('dark');
    localStorage.setItem('darkMode', document.body.classList.contains('dark'));
  });

  // Your FX, categories, 50/30/20, compute, snapshot logic goes here exactly from your previous script
  // You can reuse all functions: updateFX(), addRow(), compute(), triggerCompute(), presetExample(), etc.

  // Example: Populate currency dropdown
  const CUR = { USD:"$", EUR:"€", GBP:"£", JPY:"¥", CAD:"$", AUD:"$", INR:"₹", NGN:"₦", ZAR:"R", KES:"KSh", TZS:"TSh", UGX:"USh" };
  const currencySelect = document.getElementById('currency');
  Object.keys(CUR).forEach(c=>currencySelect.innerHTML += `<option value="${c}" ${c==='USD'?'selected':''}>${c} ${CUR[c]}</option>`);

  // Initialize categories and compute
  const state = { incomeUSD: 3500, rows: [] };
  function triggerCompute(){ /* implement 50/30/20 compute here */ }
  function presetExample(){ /* add example rows */ }
  presetExample();
  triggerCompute();
})();
</script>
</body>
</html>
